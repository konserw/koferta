version: "{branch}-ci-{build}"
shallow_clone: true

os:
- Visual Studio 2013

platform:
- Win32

configuration:
- Release

on_finish:
#   - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

environment:
  QTDIR: C:\Qt\5.5\msvc2013 
  KOFERTA_SQL_USER:
    secure: 19mGGsfTpPugnOgB7dY9iA== 
  KOFERTA_SQL_PWD:
    secure: M29h/Xk+S5xlKx22exgIz4j5M8Iu9cAwHHpyi25Yd9QKty65NIzlPSQvgZSvkzUD

install:
#- git submodule init
#- git submodule update
- cmd: '"C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat" x86'
- set PATH=%PATH%;%QTDIR%\bin
- qmake -v

build_script:
- cmd: build_script.bat

after_build:
- cmd: package_script.bat

test_script:

artifacts:
  - path: kOferta_x86.7z
    name: kOferta_x86.7z

notifications:
- provider: Email
  to:
    - konserw@gmail.com
  subject: kOferta AppVeyor Build
  on_build_success: false
  on_build_failure: true
  on_build_status_changed: true

deploy:
  description: "# Version %APPVEYOR_REPO_TAG_NAME% arch x86 

## Requirements:

* none"
  provider: GitHub
  auth_token:
    secure: ogmv8nz5XumGTJew9jWXUvPQ8U4J9t4z7WcAIG+xYHrbqnenBO5x0NUZvCMitga6 
  artifact: kOferta_x86.7z 
  draft: false
  prerelease: false
  on:
    branch: master                 # release from master branch only
    appveyor_repo_tag: true        # deploy on tag push only

